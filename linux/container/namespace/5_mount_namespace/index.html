<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.62.0" />
    <meta name="description" content="">
<meta name="author" content="Seungha Son">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>5. Mount namespace :: Developer&#39;s Delight</title>

    
    <link href="/css/nucleus.css?1577857997" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1577857997" rel="stylesheet">
    <link href="/css/hybrid.css?1577857997" rel="stylesheet">
    <link href="/css/featherlight.min.css?1577857997" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1577857997" rel="stylesheet">
    <link href="/css/auto-complete.css?1577857997" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1577857997" rel="stylesheet">
    <link href="/css/theme.css?1577857997" rel="stylesheet">
    <link href="/css/hugo-theme.css?1577857997" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1577857997" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1577857997"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/linux/container/namespace/5_mount_namespace/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
<font size="5" color="white">DEVELOPER'S DELIGHT</font>
	<br>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1577857997"></script>
<script type="text/javascript" src="/js/auto-complete.js?1577857997"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1577857997"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/linux/" title="Linux" class="dd-item 
        parent
        
        
        ">
      <a href="/linux/">
          <b>1. </b>Linux
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/linux/compilelink/" title="Compile&amp;Link" class="dd-item 
        
        
        
        ">
      <a href="/linux/compilelink/">
          Compile&amp;Link
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/linux/compilelink/gcc_warning_option/" title="[gcc] Warning 옵션" class="dd-item ">
        <a href="/linux/compilelink/gcc_warning_option/">
        [gcc] Warning 옵션
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/linux/compilelink/gcc_specific_attribute/" title="[gcc] 최적화 속성 사용하기" class="dd-item ">
        <a href="/linux/compilelink/gcc_specific_attribute/">
        [gcc] 최적화 속성 사용하기
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/linux/compilelink/staticliblink/" title="정적 라이브러리 링크" class="dd-item ">
        <a href="/linux/compilelink/staticliblink/">
        정적 라이브러리 링크
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/linux/container/" title="Container" class="dd-item 
        parent
        
        
        ">
      <a href="/linux/container/">
          Container
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/linux/container/namespace/" title="Namespace" class="dd-item 
        parent
        
        
        ">
      <a href="/linux/container/namespace/">
          Namespace
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/linux/container/namespace/1.what_is_namespace/" title="1. Namespace" class="dd-item ">
        <a href="/linux/container/namespace/1.what_is_namespace/">
        1. Namespace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/linux/container/namespace/2_pid_namespace/" title="2. PID Namespace" class="dd-item ">
        <a href="/linux/container/namespace/2_pid_namespace/">
        2. PID Namespace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/linux/container/namespace/3.user_namespace/" title="3. User Namespace" class="dd-item ">
        <a href="/linux/container/namespace/3.user_namespace/">
        3. User Namespace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/linux/container/namespace/4.qemu/" title="4. QEMU" class="dd-item ">
        <a href="/linux/container/namespace/4.qemu/">
        4. QEMU
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/linux/container/namespace/5_mount_namespace/" title="5. Mount namespace" class="dd-item active">
        <a href="/linux/container/namespace/5_mount_namespace/">
        5. Mount namespace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/linux/container/namespace/6.uts_namespace/" title="6. UTS namespace" class="dd-item ">
        <a href="/linux/container/namespace/6.uts_namespace/">
        6. UTS namespace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/linux/container/namespace/7.cgroup_namespace/" title="7. Cgroup Namespace" class="dd-item ">
        <a href="/linux/container/namespace/7.cgroup_namespace/">
        7. Cgroup Namespace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/linuxias"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.linkedin.com/in/seungha-son-a97a02b3/"><i class='fab fa-linkedin'></i> Linked In</a>
              </li>
          
              <li> 
                  <a class="padding" href="mailto:linuxias@gmail.com"><i class='fas fa-envelope'></i> linuxias@gmail.com</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Developer's Delight</a> > <a href='/linux/'>Linux</a> > <a href='/linux/container/'>Container</a> > <a href='/linux/container/namespace/'>Namespace</a> > 5. Mount namespace
          
         
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#mount-">mount의 종류</a></li>
    <li><a href="#restriction-on-mount-namespace">Restriction on mount namespace</a></li>
    <li><a href="#heading">실습</a></li>
    <li><a href="#--">참고자료 및 문헌</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              5. Mount namespace
            </h1>
          

        



<p>mount namespace는 프로세스와 그 자식 프로세스에게 다른 파일시스템 마운트 포인트를 제공합니다. 각 namespace instance의 프로세스들에게 보여지는 마운트 포인트를 격리시키는 기능을 제공합니다. 이렇게 격리된 마운트 포인트는 각 프로세스에게 단일 디렉토리 구조로 보여지게됩니다.</p>
<p>처음 설치된 시스템에서는 기본적으로 모든 프로세스가 하나의 mount namespaece(기본 namespace)에 속하기 때문에 파일시스템를 마운트하거나 해제하는 등의 모든 사항을 확인 및 인지할 수 있습니다.</p>
<p><strong>clone(2)</strong> 또는 <strong>unshare()</strong> 시스템 콜과 <strong>CLONE_NEWNS</strong> 플래그를 사용하여 새로운 프로세스를 생성하면 생성하는 프로세스의 mount namespace를 그대로 복사하여 생성하게 됩니다.</p>
<h2 id="mount-">mount의 종류</h2>
<p>mount 할 때 private, shared, slave 옵션을 이용하여 mount를 할 수 있습니다. 각 방식의 차이는 아래와 같습니다.</p>
<table>
<thead>
<tr>
<th>mount</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td>private mount</td>
<td>각 마운트 포인트가 다른 마운트 포인트에 반영되지 않는 방법</td>
</tr>
<tr>
<td>shared mount</td>
<td>각 마운트 포인트가 다른 마운트 포인트에 반영되어 보여지는 방법(양방향)</td>
</tr>
<tr>
<td>slave mount</td>
<td>A 파일시스템 하위에서 새로운 마운트는 B 파일시스템에 반영되나, 반대는 반영되지 않는 방법(단방향)</td>
</tr>
</tbody>
</table>
<p>manual page를 검색하면 아래와 같이 나뉘어져 있습니다.</p>
<pre><code>                                source(A)
                        shared  private    slave         unbind
   ──────────────────────────────────────────────────────────────────
   dest(B)  shared    | shared  shared     slave+shared  invalid
            nonshared | shared  private    slave         unbindable
</code></pre>
<h2 id="restriction-on-mount-namespace">Restriction on mount namespace</h2>
<ul>
<li>
<p>mount namespace는 owner user namespace를 가지고 있습니다. 부모 mount namespace의 owner user namespace와 다른 mount namespace는 그 권한이 낮다고 판단할 수 있습니다.</p>
</li>
<li>
<p>권한이 낮은 mount namespace를 생성할 때, shared mount namespace는 slave mounts로 권한이 낮아집니다.</p>
</li>
</ul>
<h2 id="heading">실습</h2>
<ol>
<li>임시 디렉토리를 생성한다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">linuxias$ mkdir /tmp/mount_ns
</code></pre></div><ol start="2">
<li><strong>unshare(1)</strong> 를 이용하여 새로운 bash 프로세스를 생성할 때 새로운 마운트 네임스페이스를 생성한다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">linuxias$ sudo unshare -m /bin/bash
</code></pre></div><ol start="3">
<li>bash 프로세스가 별도의 네임스페이스에 속함을 확인한다. readlink 명령어를 이용해 네임스페이스의 inode 번호를 확인한다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root# readlink /proc/$$/ns/mount
mnt:<span style="color:#f92672">[</span>4026532199<span style="color:#f92672">]</span>
</code></pre></div><ol start="4">
<li>임시 마운트 지점을 생성하여 1번에서 생성한 디렉토리에 마운트 시킨다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root# mount -n -t tmpfs tmpfs /tmp/mount_ns
</code></pre></div><ol start="5">
<li>새로 생성한 마운트 지점을 확인한다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root# mount | grep mount_ns
or
root# cat /proc/mounts | grep mount_ns
</code></pre></div><ol start="6">
<li>새로운 터미널을 열고, 네임스페이스 inode를 확인한다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">linuxias$ readlink /proc/$$/ns/mount
mnt:<span style="color:#f92672">[</span>4026531840<span style="color:#f92672">]</span>
</code></pre></div><ol start="7">
<li>새로운 터미널에서 마운트 지점을 확인한다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">linuxias$ mount | grep mount_ns
or
linuxias$ cat /proc/mounts | grep mount_ns
</code></pre></div><p>위 실습을 통해 알 수 있는 것은 새로 생성한 mount namespace 내에서 새로운 마운트 지점을 생성해도 기본 namespace에서는 알 수 없다는 것이다. 즉 독립화 되어 동작하게 됩니다.</p>
<h2 id="--">참고자료 및 문헌</h2>
<ul>
<li>Konstantin Ivanov | Containerization with LXC</li>
<li>linux manual page - mount_namespace</li>
</ul>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/linux/container/namespace/4.qemu/" title="4. QEMU"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/linux/container/namespace/6.uts_namespace/" title="6. UTS namespace" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1577857997"></script>
    <script src="/js/perfect-scrollbar.min.js?1577857997"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1577857997"></script>
    <script src="/js/jquery.sticky.js?1577857997"></script>
    <script src="/js/featherlight.min.js?1577857997"></script>
    <script src="/js/highlight.pack.js?1577857997"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1577857997"></script>
    <script src="/js/learn.js?1577857997"></script>
    <script src="/js/hugo-learn.js?1577857997"></script>

    <link href="/mermaid/mermaid.css?1577857997" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1577857997"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

